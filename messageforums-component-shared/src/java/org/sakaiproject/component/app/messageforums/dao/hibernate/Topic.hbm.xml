<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping
    PUBLIC "-//Hibernate/Hibernate Mapping DTD//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd">

<hibernate-mapping>

  <class 
      name="org.sakaiproject.component.app.messageforums.dao.hibernate.TopicImpl"
      table="MFR_TOPIC_T" 
      optimistic-lock="version" 
      discriminator-value="TO">

    <!-- Inherited fields from MutableEntity -->
    <id name="id">
      <column name="ID" not-null="true" length="19" />
      <generator class="native">
        <param name="sequence">MFR_TOPIC_S</param>
      </generator>
    </id>

	<!--  Discriminator field used for polymophism in the database -->
    <discriminator column="TOPIC_DTYPE" type="string" length="2" />
       
	<!--  Version number used for optimistic locking -->
    <version name="version" column="VERSION" />

    <property name="uuid" column="UUID" length="36" not-null="true" />
    <property name="created" column="CREATED" not-null="true" />
    <property name="createdBy" column="CREATED_BY" length="36" not-null="true" />
    <property name="modified" column="MODIFIED" not-null="true" />
    <property name="modifiedBy" column="MODIFIED_BY" length="36" not-null="true" />

    <!-- Topic fields -->
    <property name="title">
      <column name="TITLE" length="255" not-null="true" />
    </property>
    <property name="shortDescription">
      <column name="SHORT_DESCRIPTION" length="255" not-null="true" />
    </property>
    <property name="extendedDescription" type="text">
      <column name="EXTENDED_DESCRIPTION" not-null="true" />
    </property>
    <set name="attachments" lazy="true" sort="natural"
         order-by="attachmentName asc" cascade="all-delete-orphan">
        <key column="surrogateKey"/>                        
        <one-to-many class="org.sakaiproject.component.app.messageforums.dao.hibernate.AttachmentImpl"/>            
    </set>     
    <property name="mutable">
      <column name="MUTABLE" not-null="true" />
    </property>
    <property name="sortIndex">
      <column name="SORT_INDEX" length="10" not-null="true" />
    </property>
 <!-- Fix me    
     <many-to-one name="type" column="TYPE"
      class="org.sakaiproject.component.app.messageforums.dao.hibernate.TypeImpl"
      not-null="false" cascade="none" />     -->
      
    <!-- OpenTopic fields -->
    <subclass
        name="org.sakaiproject.component.app.messageforums.dao.hibernate.OpenTopicImpl"
        discriminator-value="OT">
      <many-to-one name="controlPermissions" column="CONTROL_PERMISSIONS"
        class="org.sakaiproject.component.app.messageforums.dao.hibernate.ControlPermissionsImpl"
        not-null="false" cascade="none" />
      <many-to-one name="messagePermissions" column="MESSAGE_PERMISSIONS"
        class="org.sakaiproject.component.app.messageforums.dao.hibernate.MessagePermissionsImpl"
        not-null="false" cascade="none" />
      <property name="locked">
        <column name="LOCKED" not-null="false" />
      </property>      

	  <!-- DiscussionTopic fields -->
	  <subclass 
	      name="org.sakaiproject.component.app.messageforums.dao.hibernate.DiscussionTopicImpl"
	      discriminator-value="DT">
	    <property name="confidentialResponses">
	      <column name="CONFIDENTIAL_RESPONSES" not-null="false" />
	    </property>        
	    <property name="mustRespondBeforeReading">
	      <column name="MUST_RESPOND_BEFORE_READING" not-null="false" />
	    </property>        
	    <property name="hourBeforeResponsesVisible">
	      <column name="HOUR_BEFORE_RESPONSES_VISIBLE" length="10" not-null="false" />
	    </property>    
	    <many-to-one name="dateRestrictions" column="DATE_RESTRICTIONS"
	      class="org.sakaiproject.component.app.messageforums.dao.hibernate.DateRestrictionsImpl"
	      not-null="false" cascade="none" />
	    <many-to-one name="actorPermissions" column="ACTOR_PERMISSIONS"
	      class="org.sakaiproject.component.app.messageforums.dao.hibernate.ActorPermissionsImpl"
	      not-null="false" cascade="none" />
        <set name="labels" lazy="true" sort="natural"
             cascade="all-delete-orphan">
            <key column="surrogateKey"/>                        
            <one-to-many class="org.sakaiproject.component.app.messageforums.dao.hibernate.LabelImpl"/>            
        </set>
   	    <property name="moderated">
	      <column name="MODERATED" not-null="false" />
	    </property>        
	    <property name="gradebook">
	      <column name="GRADEBOOK" length="255" not-null="false" />
	    </property>    
	    <property name="gradebookAssignment">
	      <column name="GRADEBOOK_ASSIGNMENT" length="255" not-null="false" />
	    </property>
	  </subclass>

    </subclass>
            
  </class>

  <query name="findTopicById">
    <![CDATA[from org.sakaiproject.component.app.messageforums.dao.hibernate.TopicImpl as topic where topic.id = :id]]>
  </query>

  <query name="findTopicByUuid">
    <![CDATA[from org.sakaiproject.component.app.messageforums.dao.hibernate.TopicImpl as topic where topic.uuid = :uuid]]>
  </query>

</hibernate-mapping>
